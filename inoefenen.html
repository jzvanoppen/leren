<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Woordjes Oefenen</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:900px;margin:24px auto;padding:0 12px}
    input,select,button{font-size:1rem;padding:8px;margin:6px 0}
    #quiz{display:none;margin-top:16px}
    .big{font-size:1.25rem}
    #resultaat{margin-top:8px}
    table,th,td{border:1px solid #444;border-collapse:collapse;padding:6px}
    th{background:#f0f0f0}
    .correct{color:green}
    .wrong{color:red}
    .hint{font-style:italic;color:#333}
    .inline{display:inline-block;margin-right:8px}
  </style>
</head>
<body>
  <a href="index.html">← Terug naar index</a>
  <h1>Woordjes Oefenen</h1>

  <label class="inline">Bestandsnaam (4 tekens):</label>
  <input id="fileInput" maxlength="4" placeholder="bv. iaab" />
  <br>
  <label class="inline">Hoeveel woorden oefenen?</label>
  <select id="limietSelect">
    <option value="0">Alles</option>
    <option value="10">10</option>
    <option value="15">15</option>
    <option value="20">20</option>
    <option value="25">25</option>
  </select>
  <br>
  <button id="startBtn" type="button" onclick="loadFile()">Start Oefenen</button>

  <div id="quiz" aria-live="polite">
    <p class="big" id="vraagNL"></p>
    <input id="antwoord" placeholder="Typ hier de vertaling en druk Enter" autocomplete="off" />
    <button id="controleerBtn" type="button">Controleer</button>
    <p id="resultaat"></p>
    <p id="score" class="hint"></p>
    <div id="einde" style="display:none;margin-top:12px"></div>
  </div>

  <h2>Overzicht Tekstbestanden</h2>
  <table id="overzicht">
    <tr><th>Bestand</th><th>Aantal</th><th>Beschrijving</th></tr>
    <tr><td>iabq</td><td id="iabq-count">?</td><td style="color: blue;">Chemische elementen KERST 2025-2026</td></tr>
    <tr><td>iabr</td><td id="iabr-count">?</td><td style="color: blue;">Chemische elementen volledig</td></tr>
    <tr><td>iabs</td><td id="iabs-count">?</td><td style="color: blue;">Griekse telwoorden</td></tr>
    <tr><td>iaaa</td><td id="iaaa-count">?</td><td>PASEN 2025 - FRANS  - Woordenschat H1</td></tr>
    <tr><td>iaab</td><td id="iaab-count">?</td><td>PASEN 2025 - FRANS  - L'INFINITIF</td></tr>
    <tr><td>iaac</td><td id="iaac-count">?</td><td>PASEN 2025 - FRANS  - INDICATIF PRÉSENT</td></tr>
    <tr><td>iaad</td><td id="iaad-count">?</td><td>PASEN 2025 - FRANS  - FUTUR PROCHE</td></tr>
    <tr><td>iaae</td><td id="iaae-count">?</td><td>PASEN 2025 - FRANS  - PASSÉ RÉCENT</td></tr>
    <tr><td>iaaf</td><td id="iaaf-count">?</td><td>PASEN 2025 - FRANS  - PASSÉ COMPOSÉ</td></tr>
    <tr><td>iaag</td><td id="iaag-count">?</td><td>PASEN 2025 - FRANS  - IMPARFAIT (ONREGELMATIG)</td></tr>
    <tr><td>iaah</td><td id="iaah-count">?</td><td>PASEN 2025 - FRANS  - PARTICIPE PASSÉ</td></tr>
    <tr><td>iaai</td><td id="iaai-count">?</td><td>PASEN 2025 - FRANS  - Woordenschat H2</td></tr>
    <tr><td>iaaj</td><td id="iaaj-count">?</td><td>PASEN 2025 - FRANS  - IMPARFAIT (REGELMATIG)</td></tr>
    <tr><td>iaak</td><td id="iaak-count">?</td><td>PASEN 2025 - ENGELS - Woordenschat UNIT 3 - DEEL 1</td></tr>
    <tr><td>iaal</td><td id="iaal-count">?</td><td>PASEN 2025 - ENGELS - Woordenschat UNIT 4 - DEEL 1</td></tr>
    <tr><td>iaam</td><td id="iaam-count">?</td><td>PASEN 2025 - ENGELS - Woordenschat UNIT 4 - DEEL 2</td></tr>
    <tr><td>iaan</td><td id="iaan-count">?</td><td>PASEN 2025 - ENGELS - Woordenschat UNIT 3 - DEEL 2</td></tr>
    <tr><td>iaao</td><td id="iaao-count">?</td><td>PASEN 2025 - ENGELS - vervoeging I</td></tr>
    <tr><td>iaap</td><td id="iaap-count">?</td><td>PASEN 2025 - ENGELS - vervoeging II</td></tr>
    <tr><td>iaaq</td><td id="iaaq-count">?</td><td>PASEN 2025 - ENGELS - vervoeging III</td></tr>
    <tr><td>iaar</td><td id="iaar-count">?</td><td>JUNI 2025 - ENGELS - Woordenschat UNIT 6: I</td></tr>
    <tr><td>iaas</td><td id="iaas-count">?</td><td>JUNI 2025 - ENGELS - Woordenschat UNIT 7: Signs of the Zodiac</td></tr>
    <tr><td>iaat</td><td id="iaat-count">?</td><td>JUNI 2025 - ENGELS - Woordenschat UNIT 7: Human Characteristics</td></tr>
    <tr><td>iaau</td><td id="iaau-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H14 I</td></tr>
    <tr><td>iaav</td><td id="iaav-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H14 II: LA MOBILITÉ</td></tr>
    <tr><td>iaaw</td><td id="iaaw-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H14 III: SE DÉPLACER</td></tr>
    <tr><td>iaax</td><td id="iaax-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H1????? I</td></tr>
    <tr><td>iaay</td><td id="iaay-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H1????? II</td></tr>
    <tr><td>iaaz</td><td id="iaaz-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H1????? III</td></tr>
    <tr><td>iaba</td><td id="iaba-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H1????? IV</td></tr>
    <tr><td>iabb</td><td id="iabb-count">?</td><td>JUNI 2025 - FRANS  - Woordenschat H1????? IV: BEROEPEN</td></tr>
    <tr><td>iabc</td><td id="iabc-count">?</td><td>JUNI 2025 - ENGELS - Woordenschat UNIT 6: II</td></tr>
    <tr><td>iabd</td><td id="iabd-count">?</td><td>JUNI 2025 - ENGELS - Woordenschat UNIT 6: III</td></tr>
    <tr><td>iabe</td><td id="iabe-count">?</td><td>KERRSTMIS DERDE - FRANS - Woordenschat p244+245</td></tr>
    <tr><td>iabf</td><td id="iabf-count">?</td><td>KERRSTMIS DERDE - ENGELS - Woordenschat p46 > feelings</td></tr>
    <tr><td>iabg</td><td id="iabg-count">?</td><td>KERRSTMIS DERDE - ENGELS - p47 > features American educational system</td></tr>
    <tr><td>iabh</td><td id="iabh-count">?</td><td>KERRSTMIS DERDE - ENGELS - p47 > school life: places</td></tr>
    <tr><td>iabi</td><td id="iabi-count">?</td><td>KERRSTMIS DERDE - ENGELS - p47+p48 > school life: people + objects</td></tr>
    <tr><td>iabj</td><td id="iabj-count">?</td><td>KERRSTMIS DERDE - ENGELS - p48 > school life: subjects</td></tr>
    <tr><td>iabk</td><td id="iabk-count">?</td><td>KERRSTMIS DERDE - ENGELS - p49 > school life: good to know</td></tr>
    <tr><td>iabl</td><td id="iabl-count">?</td><td>KERRSTMIS DERDE - FRANS - INDICATIF PRÉSENT - REGELMATIG</td></tr>
    <tr><td>iabm</td><td id="iabm-count">?</td><td>KERRSTMIS DERDE - FRANS - INDICATIF PRÉSENT - ONREGELMATIG</td></tr>
    <tr><td>iabn</td><td id="iabn-count">?</td><td>KERRSTMIS DERDE - FRANS - LES MOTS INTERROGATIFS</td></tr>
    <tr><td>iabo</td><td id="iabo-count">?</td><td>KERRSTMIS DERDE - FRANS - HALLOWEEN</td></tr>
    <tr><td>iabp</td><td id="iabp-count">?</td><td>KERRSTMIS DERDE - ENGELS - p46 > personality</td></tr>
    <tr><td>iabt</td><td id="iabt-count">?</td><td>KERRSTMIS DERDE - ENGELS - p89-p92 > how to describe people</td></tr>
    <tr><td>iabu</td><td id="iabu-count">?</td><td>KERRSTMIS DERDE - ENGELS - p89-p92 > how to describe people</td></tr>
    <tr><td>iabv</td><td id="iabv-count">?</td><td>KERRSTMIS DERDE - ENGELS - p89-p92 > how to describe people</td></tr>
    <tr><td>iabw</td><td id="iabw-count">?</td><td>KERRSTMIS DERDE - ENGELS - p89-p92 > how to describe people</td></tr>
    <tr><td>iabx</td><td id="iabx-count">?</td><td>KERRSTMIS DERDE - ENGELS - p89-p92 > how to describe people</td></tr>

    <tr><td><b>XXXX</b></td><td id="iabx-count">?</td><td><b>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</b></td></tr>
    
    <tr><td>zaaa</td><td id="zaaa-count">?</td><td>6C 24/25 - FRANS - Woordenschat boek 6A - P5 deel I</td></tr>
    <tr><td>zaab</td><td id="zaab-count">?</td><td>6C 24/25 - FRANS - INDICATIF PRÉSENT: dormir + sortir</td></tr>
    <tr><td>zaac</td><td id="zaac-count">?</td><td>EXTRA (1) - FRANS - De kleuren</td></tr>
    <tr><td>zaad</td><td id="zaad-count">?</td><td>EXTRA (2) - FRANS - INDICATIF PRÉSENT: être en avoir</td></tr>
    <tr><td>zaae</td><td id="zaae-count">?</td><td>EXTRA - FRANS - L'INFINITIF</td></tr>
    <tr><td>zaaf</td><td id="zaaf-count">?</td><td>6C 24/25 - FRANS - Woordenschat boek 6A - P5 deel II</td></tr>
    <tr><td>zaag</td><td id="zaag-count">?</td><td>6C 24/25 - FRANS - ALLER + transportmiddelen</td></tr>
    <tr><td>zaah</td><td id="zaah-count">?</td><td>6C 24/25 - FRANS - Woordenschat boek 6A - P6 deel I</td></tr>
    <tr><td>zaai</td><td id="zaai-count">?</td><td>6C 24/25 - FRANS - Woordenschat boek 6A - P6 deel II</td></tr>
    <tr><td>zaaj</td><td id="zaaj-count">?</td><td>6C 24/25 - FRANS - Beklemmende voornaamwoorden</td></tr>
    <tr><td>zaak</td><td id="zaak-count">?</td><td>6C 24/25 - FRANS - Getallen 0 tot 20</td></tr>
    <tr><td>zaal</td><td id="zaal-count">?</td><td>6C 24/25 - FRANS - Getallen 21 tot 69</td></tr>
    <tr><td>zaam</td><td id="zaam-count">?</td><td>6C 24/25 - FRANS - Getallen 70 tot 100</td></tr>
    <tr><td>zaan</td><td id="zaan-count">?</td><td>6C 24/25 - FRANS - Pouvoir + vouloir</td></tr>
    <tr><td>zaao</td><td id="zaao-count">?</td><td>6C 24/25 - FRANS - Getallen 100 tot 1 000 000</td></tr>
    <tr><td>zaap</td><td id="zaap-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p29 (20 woorden)</td></tr>
    <tr><td>zaaq</td><td id="zaaq-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p30 (19 woorden)</td></tr>
    <tr><td>zaar</td><td id="zaar-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p32+33 (21 woorden)</td></tr>
    <tr><td>zaas</td><td id="zaas-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p34 (16 woorden)</td></tr>
    <tr><td>zaat</td><td id="zaat-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p34 (13 woorden) > ADJECTIFS</td></tr>
    <tr><td>zaau</td><td id="zaau-count">?</td><td>1A11 25/26 - FRANS - Avoir+être p53 (34 zinnen) > ADJECTIFS</td></tr>
    <tr><td>zaav</td><td id="zaav-count">?</td><td>1A11 25/26 - FRANS - p91+92</td></tr>
    <tr><td>zaaw</td><td id="zaaw-count">?</td><td>1A11 25/26 - FRANS - p91+92</td></tr>
    <tr><td>zaax</td><td id="zaax-count">?</td><td>1A11 25/26 - FRANS - p91+92</td></tr>
    <tr><td>zaay</td><td id="zaay-count">?</td><td>1A11 25/26 - FRANS - p91+92</td></tr>
    <tr><td>zaaz</td><td id="zaaz-count">?</td><td>1A11 25/26 - FRANS - p92+93</td></tr>
    <tr><td>zaba</td><td id="zaba-count">?</td><td>1A11 25/26 - FRANS - p93+94</td></tr>
    <tr><td>zabb</td><td id="zabb-count">?</td><td>1A11 25/26 - FRANS - EX - AVOIR+ÊTRE</td></tr>
    <tr><td>zabc</td><td id="zabc-count">?</td><td>1A11 25/26 - FRANS - EX - INFINITIEF WERKWOORDEN OP -ER</td></tr>
    <tr><td>zabd</td><td id="zabd-count">?</td><td>1A11 25/26 - FRANS - EX - VERVOEGING WERKWOORDEN OP -ER</td></tr>
    <tr><td>zabe</td><td id="zabe-count">?</td><td>1A11 25/26 - FRANS - EX - INFINITIEF WERKWOORDEN OP -IR</td></tr>
    <tr><td>zabf</td><td id="zabf-count">?</td><td>1A11 25/26 - FRANS - EX - VERVOEGING WERKWOORDEN OP -IR</td></tr>
    <tr><td>zabg</td><td id="zabg-count">?</td><td>1A11 25/26 - FRANS - EX - VERVOEGING WERKWOORDEN OP -ER ZONDER INFINITIEF</td></tr>
    <tr><td>zabh</td><td id="zabh-count">?</td><td>1A11 25/26 - FRANS - EX - VERVOEGING WERKWOORDEN OP -IR ZONDER INFINITIEF</td></tr>
    <tr><td>zabi</td><td id="zabi-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p34</td></tr>
    <tr><td>zabj</td><td id="zabj-count">?</td><td>1A11 25/26 - FRANS - Woordenschat p34</td></tr>

  </table>
  <!--<button id="addRowBtn" type="button">Rij toevoegen</button>-->

  <p id="footer-note">Bestanden moeten zich bevinden in de map <code>txt/</code> en heten bijvoorbeeld <code>txt/iaab.txt</code>.<br>
  Formaat per regel: <code>nl:::fr:info</code> (bijv. <em>houden van:::aimer:INFINITIF</em>).</p>

<script>
(function(){
  // State
  let allSelected = [];
  let huidige = null;
  let stateByKey = {}; // nl -> {attempts, wrongs, done, pendingRepeat, waitingForRetype}
  let juist = 0, totaal = 0;

  const fileInput = document.getElementById('fileInput');
  const limSel = document.getElementById('limietSelect');
  const controleerBtn = document.getElementById('controleerBtn');
  const antwoord = document.getElementById('antwoord');
  const vraagNL = document.getElementById('vraagNL');
  const resultaat = document.getElementById('resultaat');
  const scoreEl = document.getElementById('score');
  const quiz = document.getElementById('quiz');
  const einde = document.getElementById('einde');

  // helpers
  function norm(s){ return (s||'').replace(/\s+/g,' ').trim().toLowerCase(); }
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

  function parseLine(line){
    // format: nl:::fr:info  (nl may contain colons)
    const idx = line.indexOf(':::');
    if(idx===-1) return null;
    const nl = line.slice(0,idx).trim();
    const rest = line.slice(idx+3);
    const parts = rest.split(':');
    const fr = (parts[0]||'').trim();
    const info = parts.slice(1).join(':').trim();
    if(!nl || !fr) return null;
    return {nl,fr,info};
  }

  // Load file
  window.loadFile = function(){
    const naam = (fileInput.value||'').trim();
    if(!/^[a-zA-Z0-9]{4}$/.test(naam)) { alert('Geef exact 4 letters/cijfers in.'); return; }
    const path = 'txt/' + naam + '.txt';

    fetch(path).then(r=>{
      if(!r.ok) throw new Error('notfound');
      return r.text();
    }).then(text=>{
      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0);
      const parsed = lines.map(parseLine).filter(x=>x);
      if(parsed.length===0){ alert('Bestand bevat geen regels met het verwachte formaat nl:::fr:info'); return; }

      // update aantal cel
      const countCell = document.getElementById(naam + '-count');
      if(countCell) countCell.textContent = parsed.length;

      // apply limit (random sample)
      const lim = parseInt(limSel.value,10)||0;
      let pool = parsed.slice();
      if(lim>0 && lim < pool.length){ pool = shuffle(pool).slice(0, lim); }

      // init state
      allSelected = pool.map((w,i)=>Object.assign({},w,{_id:i}));
      stateByKey = {};
      allSelected.forEach(w=> stateByKey[w.nl] = {attempts:0,wrongs:0,done:false,pendingRepeat:false,waitingForRetype:false});
      juist = 0; totaal = 0;

      // show quiz
      quiz.style.display = 'block';
      einde.style.display = 'none';
      antwoord.value = '';
      antwoord.focus();
      nieuwWoord();
    }).catch(err=>{
      alert('Kon bestand ' + path + ' niet laden. Controleer map txt/ en bestandsnaam.');
    });
  };

  // pick active pool
  function pickActivePool(){ return allSelected.filter(w=> !stateByKey[w.nl].done); }

  function nieuwWoord(){
    const active = pickActivePool();
    if(active.length===0) return toonEinde();
    huidige = active[Math.floor(Math.random()*active.length)];
    const info = huidige.info? ' ('+escapeHtml(huidige.info)+')' : '';
    vraagNL.innerHTML = '<b>'+escapeHtml(huidige.nl)+'</b>' + info;
    resultaat.innerHTML = '';
    antwoord.value = '';
    antwoord.focus();
    updateScore();
  }

  // check answer
  function controleer(){
    if(!huidige) return;
    const key = huidige.nl;
    const st = stateByKey[key];
    const given = (antwoord.value||'').trim();
    if(given.length===0) return; // ignore empty

    // if waiting for retype
    if(st.waitingForRetype){
      totaal++;
      if(norm(given) === norm(huidige.fr)){
        st.attempts++;
        // after correct retype, mark pendingRepeat so word returns once more later
        if(!st.pendingRepeat) st.pendingRepeat = true;
        resultaat.innerHTML = '<span class="correct">Juist — je hebt het overgetypt.</span>';
        updateScore();
        st.waitingForRetype = false;
        setTimeout(nieuwWoord,700);
      } else {
        st.wrongs++; st.attempts++;
        resultaat.innerHTML = '<span class="wrong">Nog fout. Typ exact over: <b>'+escapeHtml(huidige.fr)+'</b></span>';
        updateScore();
        // remain waitingForRetype true so they must try again
        st.waitingForRetype = true;
      }
      return;
    }

    // normal first attempt
    totaal++;
    if(norm(given) === norm(huidige.fr)){
      // correct first time
      juist++;
      st.attempts++;
      // logic for repeats: if previously wrongs>0 and not pendingRepeat -> set pendingRepeat
      if(st.wrongs>0 && !st.pendingRepeat){ st.pendingRepeat = true; }
      else {
        if(st.wrongs===0) st.done = true; else { if(st.pendingRepeat) st.done = true; else st.pendingRepeat = true; }
      }
      resultaat.innerHTML = '<span class="correct">Juist!</span>';
      updateScore();
      setTimeout(nieuwWoord,700);
    } else {
      // wrong: show correct and require retype
      st.wrongs++; st.attempts++;
      resultaat.innerHTML = '<span class="wrong">Fout. Typ exact over: <b>'+escapeHtml(huidige.fr)+'</b></span>';
      st.waitingForRetype = true;
      updateScore();
    }
  }

  // update score display
  function updateScore(){ scoreEl.textContent = juist + '/' + totaal; }

  // end screen
  function toonEinde(){
    quiz.style.display = 'none';
    einde.style.display = 'block';
    let totalWords = allSelected.length;
    let html = '<h3>Eindscore: '+juist+'/'+totaal+'</h3>';
    html += '<p>Je oefende '+totalWords+' woorden.</p>';
    const wrongEntries = Object.entries(stateByKey).filter(([k,v])=> v.wrongs>0);
    if(wrongEntries.length===0) html += '<p>Geen fouten — goed gedaan!</p>';
    else{
      html += '<h4>Foute woorden (met juiste vertaling en aantal keer fout):</h4><ul>';
      wrongEntries.forEach(([nl,v])=>{
        const wrd = allSelected.find(w=> w.nl===nl) || {fr:'?'};
        html += '<li>' + escapeHtml(nl) + ' → ' + escapeHtml(wrd.fr) + ' (x' + v.wrongs + ')</li>';
      });
      html += '</ul>';
    }
    html += '<p><a href="index.html">Terug naar index</a></p>';
    einde.innerHTML = html;
  }

  // expose controleer to button and Enter
  controleerBtn.addEventListener('click', controleer);
  antwoord.addEventListener('keydown', function(e){ if(e.key==='Enter') controleer(); });

  // add row functionality
  document.getElementById('addRowBtn').addEventListener('click', function(){
    const tbl = document.getElementById('overzicht');
    const row = tbl.insertRow(-1);
    const a = row.insertCell(0); const b = row.insertCell(1); const c = row.insertCell(2);
    a.innerHTML = '<input maxlength="4" placeholder="bestandsnaam (4)" />';
    b.innerHTML = '<input placeholder="beschrijving" />';
    c.textContent = '?';
    const inputA = a.querySelector('input');
    inputA.addEventListener('blur', function(){ const name = this.value.trim(); if(/^[a-zA-Z0-9]{4}$/.test(name)){ c.id = name + '-count'; } });
  });

  // expose for debugging
  window._woords = {loadFile: loadFile, controleer: controleer};
})();
</script>
</body>
</html>
