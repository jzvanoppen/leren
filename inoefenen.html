<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Woordjes Oefenen</title>
  <link rel="icon" type="image/png" href="img/favicon_F56565_192.png">
  <link rel="apple-touch-icon" href="img/favicon_F56565_192.png">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:900px;margin:24px auto;padding:0 12px}
    input,select,button{font-size:1rem;padding:8px;margin:6px 0}
    #quiz{display:none;margin-top:16px}
    .big{font-size:1.25rem}
    #resultaat{margin-top:8px}
    .correct{color:green}
    .wrong{color:red}
    .hint{font-style:italic;color:#333}
    .inline{display:inline-block;margin-right:8px}
  </style>
</head>
<body>
<h1>Woordjes Oefenen</h1>

<label class="inline">Bestandsnaam (4 tekens):</label>
<input id="fileInput" maxlength="4" placeholder="bv. iaab" />
<br>

<label class="inline">Hoeveel woorden oefenen?</label>
<select id="limietSelect">
  <option value="0">Alles</option>
  <option value="10">10</option>
  <option value="15">15</option>
  <option value="20">20</option>
  <option value="25">25</option>
</select>
<br>

<label class="inline">Uitspraak:</label>
<select id="ttsLang">
  <option value="fr-FR">Frans</option>
  <option value="en-US">Engels</option>
</select>
<br>

<button type="button" onclick="loadFile()">Start Oefenen</button>

<div id="quiz">
  <p class="big" id="vraagNL"></p>
  <input id="antwoord" placeholder="Typ hier de vertaling en druk Enter" autocomplete="off" />
  <button id="controleerBtn" type="button">Controleer</button>
  <p id="resultaat"></p>
  <p id="score" class="hint"></p>
</div>

<script>
(function(){
  let allSelected=[], huidige=null, stateByKey={}, juist=0, totaal=0;

  const antwoord=document.getElementById('antwoord');
  const vraagNL=document.getElementById('vraagNL');
  const resultaat=document.getElementById('resultaat');
  const scoreEl=document.getElementById('score');
  const quiz=document.getElementById('quiz');
  const ttsLang=document.getElementById('ttsLang');

  function norm(s){return(s||'').trim().toLowerCase();}
  function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;');}

  function speak(text){
    if(!window.speechSynthesis) return;
    const u=new SpeechSynthesisUtterance(text);
    u.lang=ttsLang.value;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }

  function parseLine(l){
    const i=l.indexOf(':::');
    if(i===-1) return null;
    return {nl:l.slice(0,i).trim(), fr:l.slice(i+3).split(':')[0].trim()};
  }

  window.loadFile=function(){
    fetch('txt/'+fileInput.value+'.txt')
      .then(r=>r.text())
      .then(t=>{
        allSelected=t.split(/\n/).map(parseLine).filter(x=>x);
        stateByKey={};
        allSelected.forEach(w=>stateByKey[w.nl]={done:false,waiting:false});
        quiz.style.display='block';
        nieuwWoord();
      });
  };

  function nieuwWoord(){
    const a=allSelected.filter(w=>!stateByKey[w.nl].done);
    if(!a.length) return;
    huidige=a[Math.floor(Math.random()*a.length)];
    vraagNL.innerHTML='<b>'+escapeHtml(huidige.nl)+'</b>';
    antwoord.value='';
  }

  function controleer(){
    const st=stateByKey[huidige.nl];

    if(!st.waiting) totaal++;

    if(norm(antwoord.value)===norm(huidige.fr)){
      if(!st.waiting){     // âœ… FIX
        juist++;
      }
      resultaat.innerHTML='<span class="correct">Juist!</span>';
      speak(huidige.fr);
      st.done=true;
      st.waiting=false;
      setTimeout(nieuwWoord,700);
    }else{
      resultaat.innerHTML='<span class="wrong">Fout. Juiste antwoord: <b>'+escapeHtml(huidige.fr)+'</b></span>';
      speak(huidige.fr);
      st.waiting=true;
    }

    scoreEl.textContent=juist+'/'+totaal;
  }

  controleerBtn.onclick=controleer;
  antwoord.onkeydown=e=>{if(e.key==='Enter') controleer();};
})();
</script>
</body>
</html>
