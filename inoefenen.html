<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Woordtrainer</title>
<style>
body{font-family:Arial;margin:20px;background:#f4f4f4}
#quiz,#einde{display:none}
input[type=text]{padding:8px;font-size:18px;width:300px}
button{padding:10px 16px;font-size:16px;border-radius:6px;border:1px solid #444;background:#fff;cursor:pointer}
ul{line-height:1.6}
</style>
</head>
<body>
<h1>Woordentrainer</h1>
<div id="start">
    <p>Kies woordenlijst:</p>
    <input type="file" id="fileInput"><br><br>
    <button onclick="startOefening()">Start</button>
</div>

<div id="quiz">
    <h2 id="vraag"></h2>
    <input type="text" id="antwoord" onkeydown="if(event.key==='Enter')controleer()"><br><br>
    <button onclick="controleer()">OK</button>
</div>

<div id="einde"></div>

<script>
let woorden = [];
let allSelected = [];
let stateByKey = {};
let idx = 0;
let juist = 0;
let totaal = 0;
let current = null;

function escapeHtml(t){return t.replace(/[&<>]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));}

function startOefening(){
    const f = document.getElementById('fileInput').files[0];
    if(!f){alert('Geen bestand');return;}
    const r = new FileReader();
    r.onload = function(){
        woorden = r.result.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
        allSelected = woorden.map(l=>{
            const p = l.split(':');
            return {raw:l,nl:p[0],fr:p[1]||"",info:p[2]||""};
        });
        stateByKey={};
        allSelected.forEach(w=>stateByKey[w.nl]={wrongs:0});
        totaal = allSelected.length;
        idx = 0;
        juist = 0;
        document.getElementById('start').style.display='none';
        document.getElementById('quiz').style.display='block';
        toonVolgende();
    };
    r.readAsText(f);
}

function toonVolgende(){
    if(idx>=allSelected.length){toonEinde();return;}
    current = allSelected[idx];
    document.getElementById('vraag').textContent = current.fr;
    document.getElementById('antwoord').value='';
    document.getElementById('antwoord').focus();
}

function controleer(){
    const inp = document.getElementById('antwoord').value.trim();
    if(inp.toLowerCase() === current.nl.toLowerCase()){
        juist++;
    } else {
        stateByKey[current.nl].wrongs++;
    }
    idx++;
    toonVolgende();
}

function toonEinde(){
    quiz.style.display = 'none';
    einde.style.display = 'block';

    let html = '';
    html += '<h2>Einde</h2>';
    html += '<p>Score: '+juist+'/'+totaal+'</p>';

    const wrongList = allSelected.filter(w => stateByKey[w.nl].wrongs > 0);

    if(wrongList.length===0){
        html += '<p>Geen fouten! Goed gedaan.</p>';
    } else {
        html += '<h3>Foute woorden</h3>';
        html += '<ul style="background:#fee;padding:10px;border-radius:8px">';
        wrongList.forEach(w=>{
            html += '<li>'+escapeHtml(w.raw)+'</li>';
        });
        html += '</ul>';
    }

    html += '<p><a href="index.html">Terug</a></p>';

    einde.innerHTML = html;
}
</script>
</body>
</html>
