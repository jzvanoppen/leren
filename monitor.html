<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Voorvallen Tracker</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; }
  h1 { margin-top:0; }

  #inputBox {
    width:100%; padding:10px; font-size:16px;
    border-radius:8px; border:1px solid #999;
  }

  #addBtn {
    margin-top:10px; padding:10px 18px; border:none;
    background:#0066cc; color:#fff; cursor:pointer;
    border-radius:8px; font-size:16px;
  }

  #grid {
    margin-top:20px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:15px;
  }

  .tile {
    background:white; padding:15px;
    border-radius:12px;
    box-shadow:0 2px 5px rgba(0,0,0,0.15);
    transition:0.3s;
  }

  .code {
    font-size:20px; font-weight:bold;
  }

  .date, .count {
    margin-top:5px; font-size:14px;
  }

  canvas {
    margin-top:10px;
    width:100%; height:80px;
  }

</style>
</head>
<body>
<h1>Voorvallen opvolgen</h1>

<p>Voeg een voorval toe in de vorm: <b>iaab:20251011:12/15</b></p>

<input id="inputBox" placeholder="bv. iaab:20251011:12/15">
<button id="addBtn">Toevoegen</button>

<div id="grid"></div>

<script>
let data = {}; // { code: [ {date:..., score:...}, ... ] }

function parseInput(str) {
  const parts = str.split(":");
  if (parts.length !== 3) return null;

  const code = parts[0];
  const date = parts[1];

  const scoreParts = parts[2].split("/");
  if (scoreParts.length !== 2) return null;

  const score = (parseInt(scoreParts[0]) / parseInt(scoreParts[1])) * 100;

  return { code, date, score };
}

function colorForDate(date, minDate, maxDate) {
  const d = new Date(date);
  const min = new Date(minDate);
  const max = new Date(maxDate);

  const ratio = (d - min) / (max - min + 1);

  // 0 = oud → rood (#8B0000)
  // 1 = nieuw → groen (#006400)

  const r = Math.floor(139 + (0 - 139) * ratio);
  const g = Math.floor(0 + (100 - 0) * ratio);
  const b = Math.floor(0 + (0 - 0) * ratio);

  return `rgb(${r},${g},${b})`;
}

function drawChart(canvas, values) {
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const w = canvas.width;
  const h = canvas.height;

  const max = 100;
  const min = 0;

  ctx.beginPath();
  values.forEach((v, i) => {
    const x = (i / (values.length - 1)) * w;
    const y = h - (v - min) / (max - min) * h;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();
}

function updateGrid() {
  const allDates = Object.values(data)
    .flat()
    .map(e => e.date);

  const minDate = Math.min(...allDates.map(d => new Date(d)));
  const maxDate = Math.max(...allDates.map(d => new Date(d)));

  const grid = document.querySelector("#grid");
  grid.innerHTML = "";

  Object.keys(data).sort().forEach(code => {
    const list = data[code].sort((a,b)=>b.date.localeCompare(a.date));
    const last = list[0];

    const tile = document.createElement("div");
    tile.className = "tile";
    tile.style.background = colorForDate(last.date, minDate, maxDate);

    tile.innerHTML = `
      <div class="code">${code}</div>
      <div class="count"><b>Aantal:</b> ${list.length}</div>
      <div class="date"><b>Laatste:</b> ${last.date}</div>
      <canvas></canvas>
    `;

    grid.appendChild(tile);

    const canvas = tile.querySelector("canvas");
    drawChart(canvas, list.map(e=>e.score));
  });
}

document.querySelector("#addBtn").onclick = () => {
  const inp = document.querySelector("#inputBox").value.trim();
  const item = parseInput(inp);
  if (!item) return alert("Fout formaat!");

  if (!data[item.code]) data[item.code] = [];
  data[item.code].push({ date: item.date, score: item.score });

  document.querySelector("#inputBox").value = "";

  updateGrid();
};
</script>
</body>
</html>
