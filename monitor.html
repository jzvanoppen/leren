<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Voorvallen Tracker</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; }
  h1 { margin-top:0; }

  #grid {
    margin-top:20px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:15px;
  }

  .tile {
    background:white;
    padding:15px;
    border-radius:12px;
    color:white;
    box-shadow:0 2px 5px rgba(0,0,0,0.20);
    transition:0.3s;
  }

  .code { font-size:20px; font-weight:bold; }
  .dates, .count { margin-top:5px; font-size:14px; }
  canvas { margin-top:10px; width:100%; height:80px; }
</style>
</head>
<body>

<h1>Voorvallen opvolgen</h1>
<p>Voorvallen worden rechtstreeks in de HTML-code toegevoegd.</p>

<div id="grid"></div>

<script>
// ------------------------------------------
// HIER VOEG JE JE EIGEN VOORVALLEN TOE
// ------------------------------------------
const RAW_DATA = [
  "iaab:20250111:12/15",
  "iaab:20250302:10/15",
  "iaab:20250601:14/15",
  "iaac:20240618:14/15",
  "iaac:20240701:13/15",
  "iaad:20241209:8/10",
  "iaae:20240210:7/10"
];
// ------------------------------------------

let data = {}; // { code: [ {date, score} ] }

function parseItem(str) {
  const parts = str.split(":");
  const code = parts[0];
  const date = parts[1];
  const [s, m] = parts[2].split("/");
  const score = (parseInt(s) / parseInt(m)) * 100;
  return { code, date, score };
}

function fmt(dateStr) {
  return dateStr.slice(0,4) + "." + dateStr.slice(4,6) + "." + dateStr.slice(6,8);
}

function drawChart(canvas, values) {
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const w = canvas.width;
  const h = canvas.height;
  const max = 100, min = 0;

  ctx.beginPath();
  values.forEach((v,i)=>{
    const x = (i/(values.length-1))*w;
    const y = h - (v-min)/(max-min)*h;
    if (i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  });
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.stroke();
}

function computeTileColor(date, minDate, maxDate) {
  // ratio 0..1
  const d = new Date(date);
  const min = new Date(minDate);
  const max = new Date(maxDate);
  const ratio = (d - min) / (max - min || 1);

  // RED â†’ GREEN interpolation:
  // red   = rgb(170, 0, 0)
  // green = rgb(0, 120, 0)
  const r = Math.round(170 + (0 - 170) * ratio);
  const g = Math.round(0 + (120 - 0) * ratio);
  const b = 0;

  return `rgb(${r},${g},${b})`;
}

function updateGrid() {
  const grid = document.querySelector("#grid");
  grid.innerHTML = "";

  // determine earliest and latest LAST date
  const allLastDates = Object.values(data).map(list => {
    list.sort((a,b)=>b.date.localeCompare(a.date));
    return list[0].date;
  });

  const minDate = allLastDates.reduce((a,b)=>a<b?a:b);
  const maxDate = allLastDates.reduce((a,b)=>a>b?a:b);

  Object.keys(data).sort().forEach(code => {
    const list = data[code].sort((a,b)=>b.date.localeCompare(a.date));
    const last = list[0];

    const tile = document.createElement("div");
    tile.className = "tile";
    tile.style.background = computeTileColor(last.date, minDate, maxDate);

    const lastThree = list.slice(0,3).map(e => fmt(e.date)).join("<br>");

    tile.innerHTML = `
      <div class="code">${code}</div>
      <div class="count"><b>Aantal:</b> ${list.length}</div>
      <div class="dates"><b>Laatst (3x):</b><br>${lastThree}</div>
      <canvas></canvas>
    `;

    grid.appendChild(tile);

    drawChart(tile.querySelector("canvas"), list.map(e=>e.score).reverse());
  });
}

// ------------------------
// DATA INLADEN
// ------------------------
RAW_DATA.forEach(str => {
  const it = parseItem(str);
  if (!data[it.code]) data[it.code] = [];
  data[it.code].push(it);
});

updateGrid();
</script>

</body>
</html>
