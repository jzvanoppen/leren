<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Voorvallen Tracker</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; }
  h1 { margin-top:0; }

  #grid {
    margin-top:20px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:15px;
  }

  .tile {
    background:white; padding:15px;
    border-radius:12px;
    box-shadow:0 2px 5px rgba(0,0,0,0.15);
    transition:0.3s;
  }

  .code { font-size:20px; font-weight:bold; }
  .date, .count { margin-top:5px; font-size:14px; }

  canvas {
    margin-top:10px;
    width:100%; height:80px;
  }
</style>
</head>
<body>
<h1>Voorvallen opvolgen</h1>

<p>Voorvallen zijn rechtstreeks in de code toegevoegd.</p>

<div id="grid"></div>

<script>
// ------------------------------------------
// 1. HIER VOEG JE ZELF DE VOORVALLEN TOE
// ------------------------------------------
const RAW_DATA = [
  "iaab:20250111:12/15",
  "iaab:20250302:10/15",
  "iaac:20240618:14/15",
  "iaac:20240701:13/15",
  "iaad:20241209:8/10"
];
// ------------------------------------------

let data = {}; // { code: [ {date:..., score:...}, ... ] }

function parseItem(str) {
  const parts = str.split(":");
  if (parts.length !== 3) return null;

  const code = parts[0];
  const date = parts[1];

  const scoreParts = parts[2].split("/");
  const score = (parseInt(scoreParts[0]) / parseInt(scoreParts[1])) * 100;

  return { code, date, score };
}

function colorForDate(date, minDate, maxDate) {
  const d = new Date(date);
  const min = new Date(minDate);
  const max = new Date(maxDate);

  const ratio = (d - min) / (max - min + 1);

  const r = Math.floor(139 + (0 - 139) * ratio);
  const g = Math.floor(0 + (100 - 0) * ratio);
  const b = 0;

  return `rgb(${r},${g},${b})`;
}

function drawChart(canvas, values) {
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const w = canvas.width;
  const h = canvas.height;

  const max = 100, min = 0;

  ctx.beginPath();
  values.forEach((v, i) => {
    const x = (i / (values.length - 1)) * w;
    const y = h - (v - min) / (max - min) * h;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();
}

function updateGrid() {
  const allDates = Object.values(data).flat().map(e => e.date);
  const minDate = Math.min(...allDates.map(d => new Date(d)));
  const maxDate = Math.max(...allDates.map(d => new Date(d)));

  const grid = document.querySelector("#grid");
  grid.innerHTML = "";

  Object.keys(data).sort().forEach(code => {
    const list = data[code].sort((a,b)=>b.date.localeCompare(a.date));
    const last = list[0];

    const tile = document.createElement("div");
    tile.className = "tile";
    tile.style.background = colorForDate(last.date, minDate, maxDate);

    tile.innerHTML = `
      <div class="code">${code}</div>
      <div class="count"><b>Aantal:</b> ${list.length}</div>
      <div class="date"><b>Laatste:</b> ${last.date}</div>
      <canvas></canvas>
    `;

    grid.appendChild(tile);

    const canvas = tile.querySelector("canvas");
    drawChart(canvas, list.map(e=>e.score));
  });
}

// ------------------------
// DATA PARSEN EN TONEN
// ------------------------
RAW_DATA.forEach(str => {
  const item = parseItem(str);
  if (!data[item.code]) data[item.code] = [];
  data[item.code].push(item);
});

updateGrid();
</script>

</body>
</html>
